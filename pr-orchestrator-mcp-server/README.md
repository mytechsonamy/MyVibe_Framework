# PR Orchestrator MCP Server

An MCP (Model Context Protocol) server that provides VCS-native workflow with PR templates, CODEOWNERS integration, and AI provenance tracking.

## Overview

This server streamlines PR workflows by:

- **Branch management** with naming conventions
- **CODEOWNERS integration** for reviewer suggestions
- **PR template generation** with context-aware content
- **AI provenance tracking** for transparency

## Features

- **Branch Conventions**: Enforce naming patterns (feature/, bugfix/, etc.)
- **Auto-generated Templates**: Context-aware PR descriptions
- **Reviewer Suggestions**: Based on code ownership and history
- **Size Classification**: XS, S, M, L, XL based on changes
- **AI Transparency**: Track AI-generated code contributions

## Installation

```bash
cd pr-orchestrator-mcp-server

# Install dependencies
npm install

# Build
npm run build
```

## Configuration

### Claude Desktop Configuration

Add to `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "pr-orchestrator": {
      "command": "node",
      "args": ["/path/to/pr-orchestrator-mcp-server/dist/index.js"]
    }
  }
}
```

## Available Tools

### `pr_create_branch`

Create a new branch following naming conventions.

```typescript
{
  repoPath: string,
  type: BranchType,      // feature, bugfix, hotfix, release, refactor, chore
  description: string,
  ticket?: string,       // e.g., "JIRA-123"
  baseBranch?: string    // default: "main"
}
```

### `pr_validate_branch`

Validate branch name against conventions.

```typescript
{
  repoPath: string,
  branchName: string
}
```

### `pr_get_branch_info`

Get information about current or specified branch.

```typescript
{
  repoPath: string,
  branchName?: string  // default: current branch
}
```

### `pr_parse_codeowners`

Parse CODEOWNERS file and return ownership rules.

```typescript
{
  repoPath: string
}
```

### `pr_get_owners`

Get code owners for specific files.

```typescript
{
  repoPath: string,
  files: string[]
}
```

### `pr_generate_codeowners`

Auto-generate CODEOWNERS based on git history.

```typescript
{
  repoPath: string,
  strategy?: "git-history" | "directory-based" | "hybrid",
  minCommits?: number  // Minimum commits to be considered owner
}
```

### `pr_generate_template`

Generate PR description from template.

```typescript
{
  repoPath: string,
  branchName?: string,
  summary?: string,
  testing?: string,
  additionalContext?: Record<string, string>
}
```

### `pr_analyze`

Analyze PR for complexity, risk, and concerns.

```typescript
{
  repoPath: string,
  baseBranch?: string,
  includeSuggestions?: boolean
}
```

### `pr_get_size`

Get PR size classification.

```typescript
{
  repoPath: string,
  baseBranch?: string
}
```

### `pr_generate_provenance`

Generate AI provenance metadata for PR.

```typescript
{
  repoPath: string,
  model?: string,      // default: "claude-opus-4-5"
  sessionId?: string,
  baseBranch?: string
}
```

### `pr_track_ai_change`

Track an AI-generated change for provenance.

```typescript
{
  repoPath: string,
  file: string,
  changeType: "created" | "modified" | "deleted",
  description: string,
  linesChanged?: number
}
```

### `pr_suggest_reviewers`

Suggest reviewers based on code ownership and history.

```typescript
{
  repoPath: string,
  baseBranch?: string,
  maxReviewers?: number,
  includeAISuggested?: boolean
}
```

### `pr_init_workflow`

Initialize PR workflow configuration.

```typescript
{
  repoPath: string,
  preset?: "minimal" | "standard" | "strict",
  outputDir?: string
}
```

### `pr_generate_labels`

Generate appropriate labels for the PR.

```typescript
{
  repoPath: string,
  baseBranch?: string
}
```

## Branch Naming Convention

Format: `{type}/{ticket}-{description}`

| Type | Prefix | Example |
|------|--------|---------|
| Feature | `feature/` | `feature/JIRA-123-add-login` |
| Bug Fix | `bugfix/` | `bugfix/JIRA-456-fix-auth` |
| Hotfix | `hotfix/` | `hotfix/critical-security-fix` |
| Release | `release/` | `release/v2.0.0` |
| Refactor | `refactor/` | `refactor/cleanup-utils` |
| Chore | `chore/` | `chore/update-deps` |

## PR Size Classification

| Size | Files | Lines Changed |
|------|-------|---------------|
| XS | ≤ 5 | ≤ 50 |
| S | ≤ 10 | ≤ 200 |
| M | ≤ 20 | ≤ 500 |
| L | ≤ 50 | ≤ 1000 |
| XL | > 50 | > 1000 |

## AI Provenance

Every PR includes provenance metadata:

```markdown
## AI Provenance
- **Generated by**: MyVibe Framework
- **Model**: claude-opus-4-5
- **Timestamp**: 2024-01-15T10:30:00Z
- **Confidence**: 95%
- **Human Reviewed**: No

**AI-Generated Changes:**
- `src/auth/login.ts`: created - Implement login endpoint
- `src/utils/validate.ts`: modified - Add email validation
```

## Default Labels

| Label | Color | Description |
|-------|-------|-------------|
| `size/xs` | Green | Extra small PR |
| `size/s` | Light Green | Small PR |
| `size/m` | Yellow | Medium PR |
| `size/l` | Orange | Large PR |
| `size/xl` | Red | Extra large - consider splitting |
| `ai-generated` | Purple | Contains AI-generated code |
| `security` | Red | Security-related changes |
| `breaking-change` | Dark Red | Breaking change |

## License

MIT

## Author

Mustafa Yildirim
